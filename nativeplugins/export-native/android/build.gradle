plugins {
    alias(libs.plugins.android.library)
}

android {
    namespace 'com.cwriter.export'
    compileSdk {
        version = release(36)
    }

    defaultConfig {
        minSdk 26  // æé«˜minSdkåˆ°26ä»¥æ”¯æŒPOIåº“
        targetSdk 36
        versionCode 150
        versionName "1.1.0"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }

    lint {
        abortOnError false
    }
    
    sourceSets {
        main {
            assets.srcDirs = ['assets']
        }
    }
    
    // è§£å†³META-INFå†²çªï¼ŒåŒæ—¶ä¿ç•™å­—ä½“èµ„æº
    packagingOptions {
        exclude 'META-INF/DEPENDENCIES'
        exclude 'META-INF/NOTICE'
        exclude 'META-INF/LICENSE'
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/NOTICE.txt'
        pickFirst 'META-INF/gradle/incremental.annotation.processors'
        // ç¡®ä¿åŒ…å«iTextå­—ä½“èµ„æº
        pickFirst '**/*.afm'
        pickFirst '**/*.ttf'
        pickFirst '**/*.otf'
    }
    
    // å¼ºåˆ¶åŒ…å«ä¾èµ–åº“åˆ°classes.jarä¸­
    publishing {
        singleVariant('release') {
            withSourcesJar()
            withJavadocJar()
        }
    }
}

repositories {
    google()
    mavenCentral()
    flatDir {
        dirs 'libs'
    }
}

dependencies {
    // uni-app SDK - éœ€è¦ä»uni-app SDKä¸­è·å–
    compileOnly fileTree(dir: 'libs', include: ['uniapp-v8-release.aar'])
    
    // FastJSON - uni-appä½¿ç”¨
    compileOnly 'com.alibaba:fastjson:1.2.83'
    
    // Android-compatible PDF library (æ›¿æ¢PDFBox)
    api 'com.itextpdf:itext7-core:7.2.5'
    
    // DOCXç”Ÿæˆåº“ - ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†é…ç½®
    api(libs.poi) {
        exclude group: 'commons-logging', module: 'commons-logging'
    }
    api(libs.poi.ooxml) {
        exclude group: 'commons-logging', module: 'commons-logging'
        exclude group: 'org.apache.logging.log4j', module: 'log4j-api'
    }
    
    // XMLå¤„ç†ï¼ˆPOIä¾èµ–ï¼‰
    api 'org.apache.xmlbeans:xmlbeans:4.0.0'
    api 'org.apache.commons:commons-compress:1.21'
    api 'commons-codec:commons-codec:1.15'
    
    // æ·»åŠ ç¼ºå¤±çš„POIä¾èµ–
    api 'commons-io:commons-io:2.11.0'
    api 'org.apache.commons:commons-collections4:4.4'
    api 'org.apache.commons:commons-math3:3.6.1'
    
    // æ·»åŠ SLF4Jä½œä¸ºæ—¥å¿—æ¡†æ¶ï¼ˆé¿å…commons-loggingå†²çªï¼‰
    api 'org.slf4j:slf4j-android:1.7.36'
    
    // æ³¨æ„ï¼šä¸å†æ·»åŠ AndroidXæ ¸å¿ƒåº“ï¼Œè®©ä¸»é¡¹ç›®æä¾›
    // ç§»é™¤ä»¥ä¸‹ä¾èµ–é¿å…å†²çªï¼š
    // implementation 'androidx.core:core:1.12.0'
    // implementation 'androidx.appcompat:appcompat:1.6.1'
}

// ç®€åŒ–æ‰“åŒ…æµç¨‹ï¼Œé¿å…ä¾èµ–å†²çª
tasks.whenTaskAdded { task ->
    if (task.name == 'bundleReleaseAar') {
        task.doLast {
            println "ğŸ”§ AAR æ„å»ºå®Œæˆï¼Œä½¿ç”¨ api ä¾èµ–æ–¹å¼é¿å…å†²çª"
            
            def aarFile = file("build/outputs/aar/export-native-release.aar")
            if (aarFile.exists()) {
                println "âœ… AAR æ–‡ä»¶ä½ç½®: ${aarFile.absolutePath}"
                println "ğŸ’¡ æç¤ºï¼šä¾èµ–é€šè¿‡ api æ–¹å¼ä¼ é€’ï¼Œä¸»é¡¹ç›®ä¼šè‡ªåŠ¨è§£æ"
            }
        }
    }
}


