<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>墨夜文书 - 人物管理</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B35',
                        secondary: '#4ECDC4',
                        tertiary: '#45B7D1',
                        success: '#96CEB4',
                        danger: '#FFEAA7',
                        warning: '#FD79A8',
                        dark: {
                            100: '#1A1A1A',
                            200: '#2D2D2D',
                            300: '#404040',
                            400: '#525252',
                            500: '#737373'
                        },
                        text: {
                            primary: '#FFFFFF',
                            secondary: '#B3B3B3',
                            tertiary: '#808080'
                        }
                    },
                    fontFamily: {
                        'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.3)',
                        'fab': '0 6px 20px rgba(255, 107, 53, 0.4)'
                    }
                }
            }
        }
    </script>
    <style>
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .character-item {
            transition: all 0.2s ease;
            background: rgba(45, 45, 45, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .character-item:hover {
            background-color: rgba(64, 64, 64, 0.7);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .status-active {
            background-color: #96CEB4;
            color: #1A1A1A;
        }
        
        .status-dead {
            background-color: #FD79A8;
            color: #FFFFFF;
        }
        
        .status-unknown {
            background-color: #737373;
            color: #FFFFFF;
        }
        
        .glass {
            background: rgba(45, 45, 45, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .loading-spinner {
            border: 2px solid #404040;
            border-top: 2px solid #FF6B35;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            background: rgba(45, 45, 45, 0.5);
            border: 2px dashed rgba(255, 255, 255, 0.1);
        }
        
        .context-menu {
            position: absolute;
            background: rgba(45, 45, 45, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 120px;
        }
        
        .context-menu-item {
            padding: 12px 16px;
            color: #FFFFFF;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .context-menu-item:last-child {
            border-bottom: none;
        }
        
        .context-menu-item:hover {
            background-color: rgba(64, 64, 64, 0.8);
        }
        
        .context-menu-item.danger {
            color: #FD79A8;
        }
        
        .context-menu-item.danger:hover {
            background-color: rgba(253, 121, 168, 0.1);
        }
    </style>
</head>
<body class="bg-dark-100 text-text-primary font-sans">
    <!-- 状态栏 -->
    <div id="status-bar" class="bg-dark-100 text-text-primary text-sm flex justify-between items-center px-4 py-1 safe-top">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-xs"></i>
            <i class="fas fa-wifi text-xs"></i>
            <i class="fas fa-battery-three-quarters text-xs"></i>
        </div>
    </div>

    <!-- 主容器 -->
    <div id="main-container" class="min-h-screen bg-dark-100">
        <!-- 顶部导航栏 -->
        <header id="page-header" class="glass px-6 py-4 border-b border-dark-300">
            <div id="header-content" class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button id="back-btn" class="w-10 h-10 rounded-full bg-dark-300/50 backdrop-blur-md flex items-center justify-center">
                        <i class="fas fa-arrow-left text-text-secondary"></i>
                    </button>
                    <h1 id="page-title" class="text-xl font-semibold text-text-primary">人物管理</h1>
                </div>
                <button id="add-character-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>添加
                </button>
            </div>
        </header>

        <!-- 统计信息 -->
        <section id="stats-section" class="px-6 py-4">
            <div id="stats-card" class="bg-dark-200/50 rounded-lg p-4 border border-dark-300/50">
                <div id="stats-grid" class="grid grid-cols-3 gap-4 text-center">
                    <div id="total-characters">
                        <div class="text-2xl font-bold text-primary">15</div>
                        <div class="text-sm text-text-secondary">总人物</div>
                    </div>
                    <div id="active-characters">
                        <div class="text-2xl font-bold text-success">12</div>
                        <div class="text-sm text-text-secondary">活跃</div>
                    </div>
                    <div id="dead-characters">
                        <div class="text-2xl font-bold text-warning">3</div>
                        <div class="text-sm text-text-secondary">已故</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 人物列表 -->
        <section id="characters-section" class="px-6 pb-6">
            <div id="section-header" class="flex items-center justify-between mb-4">
                <h2 id="characters-title" class="text-lg font-medium text-text-primary">我的人物</h2>
                <div id="search-container" class="relative">
                    <input type="text" id="search-input" placeholder="搜索人物..." 
                           class="bg-dark-200/50 border border-dark-300/50 rounded-lg px-4 py-2 pl-10 text-text-primary placeholder-text-tertiary focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary w-48">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-tertiary"></i>
                </div>
            </div>

            <!-- 加载状态 -->
            <div id="loading-state" class="hidden text-center py-12">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-text-secondary">加载中...</p>
            </div>

            <!-- 空状态 -->
            <div id="empty-state" class="hidden empty-state rounded-lg p-8 text-center">
                <i class="fas fa-users text-4xl text-text-tertiary mb-4"></i>
                <h3 class="text-lg font-medium text-text-primary mb-2">暂无人物</h3>
                <p class="text-text-secondary mb-6">点击右上角添加按钮创建你的第一个人物</p>
                <button id="empty-add-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>创建人物
                </button>
            </div>

            <!-- 人物列表 -->
            <div id="characters-list" class="space-y-3">
                <!-- 人物项1 -->
                <div id="character-item-1" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="1">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">李</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">李星云</h4>
                                    <p class="text-sm text-text-secondary">男主角，年轻的武者</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-active px-2 py-1 rounded-full text-xs font-medium">活跃</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>

                <!-- 人物项2 -->
                <div id="character-item-2" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="2">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-pink-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">姬</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">姬如雪</h4>
                                    <p class="text-sm text-text-secondary">女主角，神秘的女子</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-active px-2 py-1 rounded-full text-xs font-medium">活跃</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>

                <!-- 人物项3 -->
                <div id="character-item-3" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="3">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">陆</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">陆林轩</h4>
                                    <p class="text-sm text-text-secondary">女配角，天真烂漫</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-active px-2 py-1 rounded-full text-xs font-medium">活跃</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>

                <!-- 人物项4 -->
                <div id="character-item-4" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="4">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">袁</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">袁天罡</h4>
                                    <p class="text-sm text-text-secondary">神秘老者，实力强大</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-unknown px-2 py-1 rounded-full text-xs font-medium">未知</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>

                <!-- 人物项5 -->
                <div id="character-item-5" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="5">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">黑</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">黑白无常</h4>
                                    <p class="text-sm text-text-secondary">反派角色，冷酷无情</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-dead px-2 py-1 rounded-full text-xs font-medium">已故</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>

                <!-- 人物项6 -->
                <div id="character-item-6" class="character-item bg-dark-200 rounded-lg p-4 cursor-pointer hover:shadow-card transition-shadow" data-character-id="6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center">
                                    <span class="text-white font-semibold text-sm">通</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-text-primary">通文馆</h4>
                                    <p class="text-sm text-text-secondary">组织首领，野心勃勃</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-active px-2 py-1 rounded-full text-xs font-medium">活跃</span>
                            <i class="fas fa-chevron-right text-text-tertiary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 右键菜单 -->
    <div id="context-menu" class="context-menu hidden">
        <div id="menu-edit" class="context-menu-item">
            <i class="fas fa-edit mr-2"></i>编辑
        </div>
        <div id="menu-delete" class="context-menu-item danger">
            <i class="fas fa-trash mr-2"></i>删除
        </div>
    </div>

    <!-- 删除确认对话框 -->
    <div id="delete-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-dark-200 rounded-lg p-6 mx-6 w-full max-w-sm border border-dark-300">
            <div class="text-center">
                <i class="fas fa-exclamation-triangle text-warning text-3xl mb-4"></i>
                <h3 class="text-lg font-medium text-text-primary mb-2">确认删除</h3>
                <p class="text-text-secondary mb-6">确定要删除这个人物吗？此操作无法撤销。</p>
                <div class="flex space-x-3">
                    <button id="cancel-delete" class="flex-1 bg-dark-300 hover:bg-dark-400 text-text-primary py-2 rounded-lg font-medium transition-colors">
                        取消
                    </button>
                    <button id="confirm-delete" class="flex-1 bg-warning hover:bg-warning/90 text-white py-2 rounded-lg font-medium transition-colors">
                        删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let currentDeleteId = null;
            let contextMenuTarget = null;

            // 返回按钮点击事件
            document.querySelector('#back-btn').addEventListener('click', function() {
                window.location.href = 'P-SERVICE.html';
            });

            // 添加人物按钮点击事件
            document.querySelector('#add-character-btn').addEventListener('click', function() {
                window.location.href = 'P-CHARACTER_ADD_EDIT.html';
            });

            // 空状态添加按钮点击事件
            document.querySelector('#empty-add-btn').addEventListener('click', function() {
                window.location.href = 'P-CHARACTER_ADD_EDIT.html';
            });

            // 人物项点击事件
            document.querySelectorAll('[id^="character-item-"]').forEach(item => {
                item.addEventListener('click', function(e) {
                    // 如果右键菜单显示中，点击其他地方关闭菜单
                    if (!document.querySelector('#context-menu').classList.contains('hidden')) {
                        document.querySelector('#context-menu').classList.add('hidden');
                        return;
                    }
                    
                    const characterId = this.getAttribute('data-character-id');
                    window.location.href = `P-CHARACTER_ADD_EDIT.html?character_id=${characterId}`;
                });

                // 长按事件（移动端）
                let pressTimer;
                item.addEventListener('touchstart', function(e) {
                    pressTimer = setTimeout(() => {
                        showContextMenu(e.touches[0].clientX, e.touches[0].clientY, this);
                    }, 500);
                });

                item.addEventListener('touchend', function() {
                    clearTimeout(pressTimer);
                });

                item.addEventListener('touchmove', function() {
                    clearTimeout(pressTimer);
                });

                // 右键事件（桌面端）
                item.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    showContextMenu(e.clientX, e.clientY, this);
                });
            });

            // 显示右键菜单
            function showContextMenu(x, y, target) {
                const contextMenu = document.querySelector('#context-menu');
                contextMenuTarget = target;
                
                contextMenu.style.left = x + 'px';
                contextMenu.style.top = y + 'px';
                contextMenu.classList.remove('hidden');
                
                // 确保菜单不超出屏幕边界
                const menuRect = contextMenu.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                if (menuRect.right > windowWidth) {
                    contextMenu.style.left = (x - menuRect.width) + 'px';
                }
                
                if (menuRect.bottom > windowHeight) {
                    contextMenu.style.top = (y - menuRect.height) + 'px';
                }
            }

            // 隐藏右键菜单
            function hideContextMenu() {
                document.querySelector('#context-menu').classList.add('hidden');
                contextMenuTarget = null;
            }

            // 点击其他地方关闭菜单
            document.addEventListener('click', function(e) {
                if (!document.querySelector('#context-menu').contains(e.target)) {
                    hideContextMenu();
                }
            });

            // 编辑菜单点击事件
            document.querySelector('#menu-edit').addEventListener('click', function() {
                if (contextMenuTarget) {
                    const characterId = contextMenuTarget.getAttribute('data-character-id');
                    window.location.href = `P-CHARACTER_ADD_EDIT.html?character_id=${characterId}`;
                }
                hideContextMenu();
            });

            // 删除菜单点击事件
            document.querySelector('#menu-delete').addEventListener('click', function() {
                if (contextMenuTarget) {
                    currentDeleteId = contextMenuTarget.getAttribute('data-character-id');
                    document.querySelector('#delete-modal').classList.remove('hidden');
                }
                hideContextMenu();
            });

            // 取消删除
            document.querySelector('#cancel-delete').addEventListener('click', function() {
                document.querySelector('#delete-modal').classList.add('hidden');
                currentDeleteId = null;
            });

            // 确认删除
            document.querySelector('#confirm-delete').addEventListener('click', function() {
                if (currentDeleteId) {
                    // 移除对应的人物项
                    const characterItem = document.querySelector(`[data-character-id="${currentDeleteId}"]`);
                    if (characterItem) {
                        characterItem.remove();
                        updateStats();
                    }
                }
                document.querySelector('#delete-modal').classList.add('hidden');
                currentDeleteId = null;
            });

            // 搜索功能
            document.querySelector('#search-input').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const characterItems = document.querySelectorAll('[id^="character-item-"]');
                
                characterItems.forEach(item => {
                    const characterName = item.querySelector('h4').textContent.toLowerCase();
                    const characterDesc = item.querySelector('p').textContent.toLowerCase();
                    
                    if (characterName.includes(searchTerm) || characterDesc.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            // 更新统计信息
            function updateStats() {
                const characterItems = document.querySelectorAll('[id^="character-item-"]');
                const totalCount = characterItems.length;
                let activeCount = 0;
                let deadCount = 0;
                
                characterItems.forEach(item => {
                    const statusSpan = item.querySelector('span[class*="status-"]');
                    if (statusSpan.classList.contains('status-active')) {
                        activeCount++;
                    } else if (statusSpan.classList.contains('status-dead')) {
                        deadCount++;
                    }
                });
                
                document.querySelector('#total-characters .text-2xl').textContent = totalCount;
                document.querySelector('#active-characters .text-2xl').textContent = activeCount;
                document.querySelector('#dead-characters .text-2xl').textContent = deadCount;
                
                // 如果没有人物，显示空状态
                if (totalCount === 0) {
                    document.querySelector('#characters-list').classList.add('hidden');
                    document.querySelector('#empty-state').classList.remove('hidden');
                }
            }

            // 模拟加载状态（页面初始化时）
            function simulateLoading() {
                const loadingState = document.querySelector('#loading-state');
                const charactersList = document.querySelector('#characters-list');
                
                loadingState.classList.remove('hidden');
                charactersList.classList.add('hidden');
                
                setTimeout(() => {
                    loadingState.classList.add('hidden');
                    charactersList.classList.remove('hidden');
                }, 1000);
            }

            // 初始化页面
            simulateLoading();
        });
    </script>
</body>
</html>